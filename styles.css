:root {
    /* Basic Bitch Palette ðŸ’… */
    --bg-grad: linear-gradient(135deg, #FFF0F5 0%, #FDEFF4 100%);
    --bg-surface: #FFFFFF;

    /* Colors */
    --primary: #E91E63; /* Hot Pink */
    --primary-light: #F8BBD0; /* Soft Pink */
    --accent: #880E4F; /* Deep Pink/Maroon */

    --text-main: #4A4A4A;
    --text-muted: #9E9E9E;

    --grid-line: #F4C2D7;
    --grid-line-bold: #E91E63;

    --cell-given: #FCE4EC;
    --cell-input: #D81B60;

    --highlight-area: #FFF8FA;
    --highlight-same: #F8BBD0;
    --selected: #FCE4EC;

    --error: #D32F2F;
    --success: #4CAF50;

    --radius: 24px; /* Extra bubbly */
    --shadow: 0 10px 25px rgba(233, 30, 99, 0.15);
}

* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    margin: 0;
    background: var(--bg-grad);
    color: var(--text-main);
    font-family: 'Montserrat', sans-serif;
    height: 100dvh;
    overflow: hidden;
    display: flex;
    justify-content: center;
}

.app-container {
    width: 100%;
    max-width: 1000px;
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 16px;
    gap: 16px;
}

/* --- Top Bar --- */
.topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 2px solid #FFF;
}

.brand {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, var(--primary), #FF80AB);
    border-radius: 14px;
    display: grid;
    place-items: center;
    font-family: 'Pacifico', cursive;
    font-size: 26px;
    color: white;
    box-shadow: 0 4px 10px rgba(233, 30, 99, 0.3);
}

.text-group h1 {
    margin: 0;
    font-family: 'Pacifico', cursive;
    font-size: 24px;
    font-weight: 400;
    color: var(--primary);
}
.version {
    font-size: 10px;
    color: var(--text-muted);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.status-bar {
    display: flex;
    gap: 10px;
}

.pill {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #FFF;
    padding: 8px 14px;
    border-radius: 99px;
    font-size: 13px;
    font-weight: 600;
    border: 1px solid var(--primary-light);
    color: var(--text-main);
}

.pill select {
    background: transparent;
    border: none;
    color: var(--text-main);
    font-family: inherit;
    font-weight: 700;
    outline: none;
    cursor: pointer;
}

.actions-top {
    display: flex;
    gap: 10px;
}

/* --- Main Layout --- */
.game-layout {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 24px;
    align-items: start;
    justify-content: center;
    min-height: 0;
}

/* --- Board --- */
.board-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
}

.board {
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    aspect-ratio: 1;
    width: min(80vh, 100%);
    max-width: 600px;
    background: #FFF;
    border: 3px solid var(--primary);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden; /* Keeps corners rounded */
}

.cell {
    position: relative;
    border: 1px solid var(--grid-line);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    user-select: none;
    transition: background 0.1s ease;
}

.cell-value {
    font-size: clamp(22px, 4.5vw, 36px);
    font-weight: 700;
    color: var(--cell-input);
    z-index: 5;
    font-family: 'Montserrat', sans-serif;
}

/* Thicker Borders for 3x3 - The "Basic" pink grid */
.cell:nth-child(3n) { border-right: 2px solid var(--grid-line-bold); }
.cell:nth-child(9n) { border-right: none; }
.cell:nth-child(n+19):nth-child(-n+27),
.cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 2px solid var(--grid-line-bold); }

/* Cell States */
.cell.given {
    background: var(--cell-given);
}
.cell.given .cell-value {
    color: var(--accent); /* Darker pink for givens */
}

.cell.selected {
    background: var(--selected);
    box-shadow: inset 0 0 0 3px var(--primary);
    z-index: 10;
}

.cell.highlight-area { background: var(--highlight-area); }
.cell.highlight-same { background: var(--highlight-same); }

.cell.error {
    background: #FFEBEE;
    animation: shake 0.3s ease-in-out;
}
.cell.error .cell-value { color: var(--error); }

.cell.animate-pop .cell-value {
    animation: pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* Notes */
.note-grid {
    position: absolute;
    inset: 2px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    pointer-events: none;
    z-index: 4;
}
.note-num {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    color: var(--text-muted);
    font-weight: 700;
}

/* --- Controls Aside --- */
.controls {
    width: 320px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    background: rgba(255,255,255,0.8);
    backdrop-filter: blur(10px);
    padding: 24px;
    border-radius: var(--radius);
    border: 2px solid #FFF;
    box-shadow: var(--shadow);
    height: fit-content;
}

/* Buttons */
button {
    font-family: 'Montserrat', sans-serif;
    cursor: pointer;
    border: none;
    transition: all 0.2s ease;
}
button:active { transform: translateY(2px); }

.btn-primary {
    background: linear-gradient(180deg, #FF80AB, var(--primary));
    color: white;
    font-weight: 700;
    padding: 10px 20px;
    border-radius: 99px;
    box-shadow: 0 4px 10px rgba(233, 30, 99, 0.3);
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 1px;
}
.btn-primary:hover { filter: brightness(1.1); }

/* Tools */
.tools-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
}
.tool-btn {
    background: #FFF;
    color: var(--accent);
    padding: 12px 4px;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    position: relative;
    border: 1px solid var(--primary-light);
}
.tool-btn:hover { background: #FFF0F5; border-color: var(--primary); }
.tool-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}
.tool-btn .icon { font-size: 20px; }
.tool-btn .label { font-size: 10px; font-weight: 700; }
.indicator {
    position: absolute;
    top: 6px; right: 6px;
    width: 8px; height: 8px;
    background: #FFEB3B; /* Yellow dot for visibility */
    border-radius: 50%;
    opacity: 0;
}
.tool-btn.active .indicator { opacity: 1; }

/* Numpad */
.numpad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}
.num-btn {
    background: #FFF;
    color: var(--primary);
    font-size: 22px;
    font-weight: 800;
    padding: 14px 0;
    border-radius: 16px;
    border: 1px solid var(--primary-light);
    position: relative;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.num-btn:hover {
    border-color: var(--primary);
    background: #FFF0F5;
    transform: translateY(-2px);
}
.num-btn .rem {
    position: absolute;
    bottom: 4px; right: 8px;
    font-size: 10px;
    color: var(--text-muted);
}
.num-btn.disabled { opacity: 0.5; pointer-events: none; background: #EEE; }

/* Secondary & Settings */
.secondary-actions {
    display: flex;
    gap: 10px;
}
.text-btn {
    flex: 1;
    background: #FFF;
    color: var(--text-main);
    padding: 12px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 700;
    border: 1px solid #E0E0E0;
}
.text-btn:hover { background: #F5F5F5; }
.text-btn.danger { color: var(--error); border-color: #FFCDD2; }
.text-btn.danger:hover { background: #FFEBEE; }

.settings-toggles {
    display: flex;
    justify-content: space-between;
    padding-top: 10px;
    border-top: 2px dashed var(--primary-light);
}
.switch-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-main);
    cursor: pointer;
}

.instructions {
    font-size: 11px;
    color: var(--text-muted);
    text-align: center;
    line-height: 1.5;
}

/* Toast */
.toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: #333;
    color: white;
    padding: 12px 24px;
    border-radius: 99px;
    font-weight: 700;
    box-shadow: var(--shadow);
    opacity: 0;
    pointer-events: none;
    transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 100;
    font-size: 14px;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* Modal */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    display: grid;
    place-items: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    z-index: 200;
}
.modal-overlay.open { opacity: 1; pointer-events: auto; }
.modal {
    background: #FFF;
    padding: 40px;
    border-radius: 30px;
    text-align: center;
    max-width: 320px;
    width: 90%;
    transform: scale(0.9);
    transition: transform 0.3s;
    border: 4px solid var(--primary-light);
    box-shadow: var(--shadow);
}
.modal-overlay.open .modal { transform: scale(1); }
.modal h2 { margin: 0 0 10px 0; color: var(--primary); font-family: 'Pacifico', cursive; font-size: 32px; }
.modal p { color: var(--text-main); margin-bottom: 25px; font-weight: 600; }

/* Animations */
@keyframes pop { 0% { transform: scale(0.8); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px); } 75% { transform: translateX(4px); } }

/* --- Responsive --- */
/* --- Responsive Fixes --- */

/* Tablet / Small Laptop */
/* --- Tablet / Small Laptop (600px - 900px) --- */
@media (max-width: 900px) {
    .app-container {
        /* Use full height so we can vertically center the board */
        height: 100dvh;
        overflow: hidden;
    }

    .game-layout {
        display: flex;
        flex-direction: column;
        height: 100%;
        /* This ensures the layout takes up space but doesn't overflow weirdly */
        overflow: hidden;
    }

    .board-container {
        /* Take up all available vertical space above the controls */
        flex: 1;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        /* Ensure board doesn't get cut off if controls are tall */
        min-height: 0;
    }

    .board {
        /* FORCE SIZE: Big but contained */
        width: min(100%, 550px) !important;
        aspect-ratio: 1 / 1;
        /* Ensure it doesn't grow taller than the available space */
        max-height: 100%;
        margin: auto;
    }

    .controls {
        /* Don't shrink this, keep it at the bottom */
        flex-shrink: 0;
        width: 100%;
        background: rgba(255,255,255,0.9);
        border-radius: 30px 30px 0 0;
        padding: 20px;
        padding-bottom: max(20px, env(safe-area-inset-bottom));
        box-shadow: 0 -10px 30px rgba(233, 30, 99, 0.1);
        border: none;
        border-top: 2px solid var(--primary-light);
        z-index: 50;
    }

    .numpad {
        display: flex;
        justify-content: space-between;
    }

    .num-btn {
        flex: 1;
        padding: 12px 0;
        font-size: 20px;
        border-radius: 12px;
    }

    /* Hide the extra stuff to save space for the board */
    .secondary-actions, .settings-toggles, .instructions {
        display: none;
    }
}

/* Mobile (The "Squish" Fix) */
/* --- Mobile Fix (The "Thicc Grid" Update) --- */
@media (max-width: 600px) {
    body {
        /* Prevent full page scroll, we handle it inside app-container */
        overflow: hidden;
    }

    .app-container {
        padding: 10px;
        gap: 10px;
        height: 100dvh; /* Use dynamic viewport height */
        display: flex;
        flex-direction: column;
    }

    /* 1. Header: Keep it compact */
    .topbar {
        flex-shrink: 0; /* Prevent header from squishing */
        display: grid;
        grid-template-columns: 1fr auto;
        grid-template-rows: auto auto;
        gap: 8px;
        padding: 10px;
        border-radius: 16px;
        background: rgba(255,255,255,0.9);
    }

    .brand { grid-column: 1; grid-row: 1; }
    .actions-top { grid-column: 2; grid-row: 1; }
    .status-bar { grid-column: 1 / -1; grid-row: 2; width: 100%; justify-content: space-between; }

    .logo { width: 32px; height: 32px; font-size: 16px; }
    .brand .text-group { display: block; }
    .text-group h1 { font-size: 16px; }
    .version { display: none; }
    .btn-primary.small { padding: 6px 12px; font-size: 10px; }
    .pill { padding: 4px 8px; font-size: 11px; flex: 1; justify-content: center; }
    .hide-on-mobile { display: none; }

    /* 2. Main Layout: Fill remaining height */
    .game-layout {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden; /* Clip content */
        min-height: 0; /* Vital for flex scrolling */
    }

    /* 3. The Board Container: CENTER STAGE */
    .board-container {
        width: 100%;
        flex: 1; /* Take all available vertical space */
        display: flex;
        align-items: center; /* Center Vertically */
        justify-content: center; /* Center Horizontally */
        /* Add massive padding bottom so the board sits above the controls */
        padding-bottom: 280px;
        padding-left: 0;
        padding-right: 0;
    }

    .board {
        /* FORCE WIDTH */
        width: 100% !important;
        max-width: 100% !important;
        aspect-ratio: 1 / 1;
        border-width: 2px;
        /* Ensure it doesn't get taller than the viewable area minus controls */
        max-height: calc(100dvh - 350px);
    }

    .cell-value { font-size: 24px; } /* Ensure numbers are readable */

    /* 4. Controls: Fixed to bottom */
    .controls {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(255,255,255,0.95);
        border-radius: 24px 24px 0 0;
        padding: 16px;
        padding-bottom: max(16px, env(safe-area-inset-bottom));
        box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
        border-top: 2px solid var(--primary-light);
        z-index: 50;
        /* If screen is super short (landscape), allow scroll within controls */
        max-height: 50%;
        overflow-y: auto;
    }

    .instructions, .secondary-actions, .settings-toggles { display: none; }

    .tools-grid { gap: 8px; margin-bottom: 12px; }
    .tool-btn { padding: 8px 0; border-radius: 12px; }
    .tool-btn .icon { font-size: 18px; }

    .numpad { gap: 6px; }
    .num-btn { padding: 12px 0; font-size: 20px; border-radius: 12px; }
}